Description: fix denial of service and possible code execution via out of bounds access
Origin: upstream, http://bugs.icu-project.org/trac/ticket/8984
Bug: http://bugs.icu-project.org/trac/ticket/8984
Bug-Debian: http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=654883

Index: icu-4.4.2/source/common/uloc.c
===================================================================
--- icu-4.4.2.orig/source/common/uloc.c	2010-09-29 14:37:20.000000000 -0400
+++ icu-4.4.2/source/common/uloc.c	2012-01-25 14:21:06.166128352 -0500
@@ -1736,7 +1736,7 @@
                 int32_t variantLen = _deleteVariant(variant, uprv_min(variantSize, (nameCapacity-len)), variantToCompare, n);
                 len -= variantLen;
                 if (variantLen > 0) {
-                    if (name[len-1] == '_') { /* delete trailing '_' */
+                    if (len > 0 && name[len-1] == '_') { /* delete trailing '_' */
                         --len;
                     }
                     addKeyword = VARIANT_MAP[j].keyword;
@@ -1744,7 +1744,7 @@
                     break;
                 }
             }
-            if (name[len-1] == '_') { /* delete trailing '_' */
+            if (len > 0 && len <= nameCapacity && name[len-1] == '_') { /* delete trailing '_' */
                 --len;
             }
         }
